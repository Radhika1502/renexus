<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Renexus Offline Sync Tests</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    .controls {
      margin: 20px 0;
      padding: 15px;
      background-color: #f5f5f5;
      border-radius: 5px;
    }
    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 10px 15px;
      text-align: center;
      text-decoration: none;
      display: inline-block;
      font-size: 16px;
      margin: 4px 2px;
      cursor: pointer;
      border-radius: 4px;
    }
    button.offline {
      background-color: #f44336;
    }
    button.online {
      background-color: #4CAF50;
    }
    button.test {
      background-color: #2196F3;
    }
    pre {
      background-color: #f8f8f8;
      border: 1px solid #ddd;
      border-radius: 3px;
      padding: 10px;
      overflow: auto;
      max-height: 500px;
    }
    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .online-status {
      background-color: #e8f5e9;
      border-left: 5px solid #4CAF50;
    }
    .offline-status {
      background-color: #ffebee;
      border-left: 5px solid #f44336;
    }
    .log-entry {
      margin: 5px 0;
    }
    .log-entry.error {
      color: #f44336;
    }
    .log-entry.success {
      color: #4CAF50;
    }
    .log-entry.info {
      color: #2196F3;
    }
  </style>
</head>
<body>
  <h1>Renexus Offline Sync Tests</h1>
  
  <div class="controls">
    <h2>Network Controls</h2>
    <button id="toggleOffline" class="online">Go Offline</button>
    <div id="networkStatus" class="status online-status">
      Current Status: <strong>Online</strong>
    </div>
  </div>
  
  <div class="controls">
    <h2>Test Controls</h2>
    <button id="runAllTests" class="test">Run All Tests</button>
    <button id="testTaskCreation" class="test">Test Offline Task Creation</button>
    <button id="testDataCaching" class="test">Test Offline Data Caching</button>
    <button id="clearLogs" class="test">Clear Logs</button>
  </div>
  
  <h2>Test Logs</h2>
  <pre id="logOutput"></pre>
  
  <script type="module">
    import { 
      setOnlineStatus, 
      testOfflineTaskCreation, 
      testOfflineDataCaching, 
      runTests 
    } from './test-offline-sync.js';
    
    // Elements
    const toggleOfflineBtn = document.getElementById('toggleOffline');
    const networkStatusDiv = document.getElementById('networkStatus');
    const runAllTestsBtn = document.getElementById('runAllTests');
    const testTaskCreationBtn = document.getElementById('testTaskCreation');
    const testDataCachingBtn = document.getElementById('testDataCaching');
    const clearLogsBtn = document.getElementById('clearLogs');
    const logOutput = document.getElementById('logOutput');
    
    // Track online status
    let isOnline = navigator.onLine;
    
    // Override console.log to display in our log output
    const originalConsoleLog = console.log;
    const originalConsoleError = console.error;
    
    console.log = function(...args) {
      originalConsoleLog.apply(console, args);
      
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry';
      
      // Check if the message indicates success or error
      const message = args.join(' ');
      if (message.includes('PASSED') || message.includes('successfully')) {
        logEntry.classList.add('success');
      } else if (message.includes('FAILED') || message.includes('Error')) {
        logEntry.classList.add('error');
      } else if (message.includes('===') || message.includes('Step')) {
        logEntry.classList.add('info');
      }
      
      logEntry.textContent = args.join(' ');
      logOutput.appendChild(logEntry);
      logOutput.scrollTop = logOutput.scrollHeight;
    };
    
    console.error = function(...args) {
      originalConsoleError.apply(console, args);
      
      const logEntry = document.createElement('div');
      logEntry.className = 'log-entry error';
      logEntry.textContent = args.join(' ');
      logOutput.appendChild(logEntry);
      logOutput.scrollTop = logOutput.scrollHeight;
    };
    
    // Update UI based on network status
    function updateNetworkStatusUI() {
      if (isOnline) {
        toggleOfflineBtn.textContent = 'Go Offline';
        toggleOfflineBtn.className = 'online';
        networkStatusDiv.className = 'status online-status';
        networkStatusDiv.innerHTML = 'Current Status: <strong>Online</strong>';
      } else {
        toggleOfflineBtn.textContent = 'Go Online';
        toggleOfflineBtn.className = 'offline';
        networkStatusDiv.className = 'status offline-status';
        networkStatusDiv.innerHTML = 'Current Status: <strong>Offline</strong>';
      }
    }
    
    // Toggle offline/online status
    toggleOfflineBtn.addEventListener('click', () => {
      isOnline = !isOnline;
      setOnlineStatus(isOnline);
      updateNetworkStatusUI();
    });
    
    // Run all tests
    runAllTestsBtn.addEventListener('click', () => {
      console.log('Running all tests...');
      runTests();
    });
    
    // Test offline task creation
    testTaskCreationBtn.addEventListener('click', () => {
      console.log('Running offline task creation test...');
      testOfflineTaskCreation();
    });
    
    // Test offline data caching
    testDataCachingBtn.addEventListener('click', () => {
      console.log('Running offline data caching test...');
      testOfflineDataCaching();
    });
    
    // Clear logs
    clearLogsBtn.addEventListener('click', () => {
      logOutput.innerHTML = '';
    });
    
    // Listen for online/offline events
    window.addEventListener('online', () => {
      isOnline = true;
      updateNetworkStatusUI();
      console.log('Browser went online');
    });
    
    window.addEventListener('offline', () => {
      isOnline = false;
      updateNetworkStatusUI();
      console.log('Browser went offline');
    });
    
    // Initialize UI
    updateNetworkStatusUI();
    console.log('Test page loaded. Use the buttons above to run tests.');
  </script>
</body>
</html>
